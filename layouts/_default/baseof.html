<!DOCTYPE html>
<!DOCTYPE html>
<html
  lang="{{ .Site.Language.Lang }}"
  class="{{ if eq (.Site.Params.colorMode | default "light") "dark" }}dark{{ end }}"
>

<head>
    {{ partial "head.html" . }}

    <!-- Color Variables - Load first to ensure CSS custom properties are available -->
    {{ partial "color-variables.html" . }}

    {{ $styles := resources.Get "css/main.css" | postCSS (dict "config" "./postcss.config.js") }}
    {{ if eq hugo.Environment "production" }}
      {{ $styles = $styles | minify | fingerprint }}
    {{ end }}
    <link
      rel="stylesheet"
      href="{{ $styles.RelPermalink }}?v={{ now.Unix }}"
      data-version="{{ now.Unix }}"
    >

    <!-- Prevent FOUC -->
    <style>
        body {
            visibility: hidden;
        }
        body.loaded {
            visibility: visible;
        }
    </style>
</head>

<body class="bg-bg dark:bg-bg text-text-primary dark:text-text-primary flex flex-col min-h-screen transition-colors duration-200">

    {{ partial "nav.html" . }}
    <div class="w-full h-16"></div>

    <main class="flex-grow">
        {{ block "main" . }}{{ end }}
    </main>

    {{ partial "footer.html" . }}

    {{ $scripts := resources.Get "js/scripts.js" }}
    {{ $gsap := resources.Get "js/gsap-animations.js" }}
    {{ $pexels := resources.Get "js/pexels-background.js" }}
    {{ $colors := resources.Get "js/dynamic-colors.js" }}
    {{ if eq hugo.Environment "production" }}
      {{ $scripts = $scripts | minify | fingerprint }}
      {{ $gsap = $gsap | minify | fingerprint }}
      {{ $pexels = $pexels | minify | fingerprint }}
      {{ $colors = $colors | minify | fingerprint }}
    {{ end }}

    {{ partial "pexels-config.html" . }}
    {{ partial "color-config.html" . }}

    <!-- ðŸŽ¯ Critical: Load pexels config and color config early, then pexels background script (MUST be in this order for LCP) -->
    <script src="{{ $pexels.RelPermalink }}" defer></script>
    
    <!-- â±ï¸ Defer non-critical scripts that don't block FCP/LCP -->
    <script src="{{ $scripts.RelPermalink }}" defer></script>
    <script src="{{ $colors.RelPermalink }}" defer></script>
    <script src="{{ $gsap.RelPermalink }}" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/fslightbox/index.js" defer></script>

    <!-- Reveal page after load -->
    <script>
        window.addEventListener('load', function () {
            document.body.classList.add('loaded');
        });
    </script>
</body>
</html>
