<nav class="fixed top-0 left-0 right-0 bg-bg dark:bg-bg shadow-md z-[100000]">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

    <div class="flex justify-between items-center h-16">

      <!-- Logo -->
      <a href="{{ .Site.Home.RelPermalink }}"
         class="text-3xl font-bold text-text-primary dark:text-text-primary font-heading">
        {{ .Site.Params.name }}
      </a>

      <!-- Desktop navigation -->
      <div class="hidden lg:flex items-center space-x-8">
        {{ range .Site.Menus.main }}
          {{ if .HasChildren }}
          <div class="relative group">
            <span class="nav-link flex items-center cursor-pointer">
              {{ .Name }}
              <i class="fas fa-chevron-down ml-2 text-sm"></i>
            </span>
            <div class="absolute left-0 top-full mt-2 bg-bg dark:bg-bg shadow-lg rounded-lg
                        opacity-0 invisible group-hover:opacity-100 group-hover:visible">
              {{ range .Children }}
                <a href="{{ .URL | relLangURL }}"
                   class="block px-4 py-2 text-sm">
                  {{ .Name }}
                </a>
              {{ end }}
            </div>
          </div>
          {{ else }}
            <a href="{{ .URL | relLangURL }}" class="nav-link">
              {{ .Name }}
            </a>
          {{ end }}
        {{ end }}

        <!-- Social icons -->
        <div class="flex space-x-4 pl-4 border-l border-text-primary/20 dark:border-text-primary/20">
          {{ if .Site.Params.linkedin_url }}
          <a href="{{ .Site.Params.linkedin_url }}" target="_blank" class="nav-link" aria-label="LinkedIn">
            <i class="fab fa-linkedin-in text-lg"></i>
          </a>
          {{ end }}
          {{ if .Site.Params.github_url }}
          <a href="{{ .Site.Params.github_url }}" target="_blank" class="nav-link" aria-label="GitHub">
            <i class="fab fa-github text-lg"></i>
          </a>
          {{ end }}
        </div>
      </div>

      <!-- Hamburger -->
      <button id="menu-btn"
              class="lg:hidden text-text-primary dark:text-text-primary text-2xl"
              aria-expanded="false"
              aria-label="Open menu">
        <i class="fas fa-bars"></i>
      </button>
    </div>
  </div>
</nav>

<!-- MOBILE MENU OVERLAY (PORTAL) -->
<div id="mobile-menu-overlay"
     class="fixed inset-0 bg-bg dark:bg-bg z-[99999] hidden">

  <div class="pt-20 px-6 space-y-4">
    {{ range .Site.Menus.main }}
      {{ if hasPrefix .URL "#" }}
      <a href="{{ printf "%s%s" $.Site.Home.RelPermalink .URL }}"
         class="block text-lg font-medium section-link"
         data-section="{{ .URL }}">
        {{ .Name }}
      </a>
      {{ else }}
      <a href="{{ .URL | relLangURL }}"
         class="block text-lg font-medium">
        {{ .Name }}
      </a>
      {{ end }}

      {{ if .HasChildren }}
        {{ range .Children }}
          <a href="{{ .URL | relLangURL }}"
             class="block pl-4 text-sm opacity-80">
            {{ .Name }}
          </a>
        {{ end }}
      {{ end }}
    {{ end }}

    <!-- Social icons -->
    <div class="flex space-x-4 pt-6">
      {{ if .Site.Params.linkedin_url }}
      <a href="{{ .Site.Params.linkedin_url }}" target="_blank" aria-label="LinkedIn">
        <i class="fab fa-linkedin-in text-xl"></i>
      </a>
      {{ end }}
      {{ if .Site.Params.github_url }}
      <a href="{{ .Site.Params.github_url }}" target="_blank" aria-label="GitHub">
        <i class="fab fa-github text-xl"></i>
      </a>
      {{ end }}
    </div>
  </div>
</div>

<!-- NAV JS -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const btn = document.getElementById('menu-btn');
  const menu = document.getElementById('mobile-menu-overlay');

  if (!btn || !menu) return;

  btn.addEventListener('click', () => {
    const open = menu.classList.toggle('hidden') === false;
    btn.setAttribute('aria-expanded', open);
    document.body.classList.toggle('overflow-hidden', open);
  });

  menu.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', () => {
      menu.classList.add('hidden');
      btn.setAttribute('aria-expanded', 'false');
      document.body.classList.remove('overflow-hidden');
    });
  });
});
</script>
